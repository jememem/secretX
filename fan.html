<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creator Sim - Hardcore Tycoon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        /* Custom Scrollbar */
        .log-scroll::-webkit-scrollbar { width: 4px; }
        .log-scroll::-webkit-scrollbar-track { background: #18181b; }
        .log-scroll::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 4px; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pop-in { animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .scan-line {
            width: 100%; height: 2px; background: #10b981;
            position: absolute; top: 0; left: 0;
            animation: scan 1.5s infinite linear;
            box-shadow: 0 0 10px #10b981;
        }
        @keyframes scan {
            0% { top: 0%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        .vibe-option.selected { border-color: #ec4899; background-color: #500724; ring: 1px solid #ec4899; }
        .vibe-option.disabled-option { opacity: 0.3; pointer-events: none; filter: grayscale(1); }
        
        .agency-card.selected { border-color: #a855f7; background-color: #3b0764; }
        
        .shop-tab.active { background-color: #27272a; border-bottom: 2px solid #ec4899; color: white; }
        .shop-tab { color: #71717a; }

        .age-btn.selected { background-color: #0f172a; border-color: #38bdf8; color: #38bdf8; }
        /* Phone Screen */
        .phone-screen { background: #000; box-shadow: inset 0 0 20px rgba(255,255,255,0.05); }
        .glass-panel { background: rgba(24, 24, 27, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.05); }
        
        /* Burnout Overlay */
        .burnout-overlay { 
            background: repeating-linear-gradient(
                45deg,
                rgba(0,0,0,0.8),
                rgba(0,0,0,0.8) 10px,
                rgba(20,0,0,0.8) 10px,
                rgba(20,0,0,0.8) 20px
            );
        }

        /* Carousel */
        .carousel-track { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; }
        .carousel-item { flex: 0 0 100%; scroll-snap-align: start; }
        .carousel-track::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-zinc-950 text-zinc-100 min-h-screen flex flex-col items-center justify-center p-4 relative overflow-hidden">

    <!-- BURNOUT OVERLAY -->
    <div id="burnout-screen" class="hidden fixed inset-0 z-[90] burnout-overlay flex flex-col items-center justify-center backdrop-blur-sm pointer-events-none">
        <h1 class="text-6xl font-black text-white mb-2 tracking-tighter animate-pulse">BURNOUT</h1>
        <p class="text-red-400 text-xl font-bold uppercase tracking-widest bg-black px-4 py-2 rounded border border-red-900">Psychological Collapse</p>
        <p class="text-zinc-400 mt-4 text-sm max-w-md text-center">You pushed too hard. You cannot work, post, or socialize.<br>Rent is still due.</p>
        <p class="text-white mt-8 font-mono text-2xl">Recovering... <span id="burnout-timer">2</span> Days Left</p>
    </div>

    <!-- BLACKMAIL MODAL -->
    <div id="blackmail-modal" class="hidden fixed inset-0 bg-black/95 z-[95] flex items-center justify-center p-4">
        <div class="bg-zinc-900 border-2 border-red-600 p-6 rounded-xl max-w-md w-full relative">
            <div class="absolute -top-3 -left-3 bg-red-600 text-white font-bold px-3 py-1 text-xs uppercase tracking-widest">Threat Detected</div>
            <h2 class="text-2xl font-bold text-white mb-2">Anonymous Message</h2>
            <p class="text-zinc-300 text-sm mb-6 bg-zinc-800 p-4 rounded italic border-l-4 border-red-500">
                "I found your old Facebook. Does your family know how you pay rent? Send cash or I send the link to your mom."
            </p>
            <div class="space-y-3">
                <button onclick="handleBlackmail('pay')" class="w-full bg-zinc-800 hover:bg-zinc-700 text-green-400 border border-green-900 font-bold py-3 rounded flex justify-between px-4">
                    <span>Pay Hush Money</span>
                    <span id="blackmail-cost">-$500</span>
                </button>
                <button onclick="handleBlackmail('ignore')" class="w-full bg-red-900/20 hover:bg-red-900/40 text-red-500 border border-red-900 font-bold py-3 rounded">
                    Ignore & Risk It (Stats -> 10)
                </button>
            </div>
        </div>
    </div>

    <!-- PARASOCIAL OFFER MODAL -->
    <div id="parasocial-modal" class="hidden fixed inset-0 bg-black/90 z-[85] flex items-center justify-center p-4">
        <div class="bg-zinc-900 border border-pink-500 p-6 rounded-xl max-w-sm w-full text-center">
            <div class="w-20 h-20 bg-pink-500/20 rounded-full mx-auto flex items-center justify-center mb-4">
                <i data-lucide="heart-handshake" class="w-10 h-10 text-pink-500"></i>
            </div>
            <h2 class="text-xl font-bold text-white mb-1">Super Fan Offer</h2>
            <p class="text-zinc-400 text-sm mb-4">"I want to be your exclusive partner. I'll pay your bills, but you belong to me."</p>
            
            <div class="bg-zinc-800 p-3 rounded mb-4 text-xs text-left">
                <div class="flex justify-between mb-1"><span class="text-green-400">Income:</span> <span>+$200 / Day</span></div>
                <div class="flex justify-between mb-1"><span class="text-red-400">Cost:</span> <span>30 Energy / Day (Chatting)</span></div>
                <div class="flex justify-between"><span class="text-orange-400">Rule:</span> <span>No Collabs / Other People</span></div>
            </div>

            <div class="flex gap-2">
                <button onclick="document.getElementById('parasocial-modal').classList.add('hidden')" class="flex-1 bg-zinc-800 py-2 rounded text-zinc-400 text-xs">Reject</button>
                <button onclick="acceptParasocial()" class="flex-1 bg-pink-600 hover:bg-pink-500 text-white font-bold py-2 rounded text-xs">Accept Partner</button>
            </div>
        </div>
    </div>

    <!-- BANK MODAL -->
    <div id="bank-modal" class="hidden fixed inset-0 bg-black/90 z-[70] flex items-center justify-center p-4">
        <div class="bg-zinc-900 border border-green-800 p-6 rounded-xl max-w-lg w-full relative overflow-hidden">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-white flex items-center gap-2"><i data-lucide="landmark" class="text-green-500"></i> SimBank</h3>
                <button onclick="closeBankModal()" class="text-zinc-500 hover:text-white"><i data-lucide="x"></i></button>
            </div>

            <!-- Active Loans -->
            <div class="mb-6">
                <h4 class="text-xs text-zinc-500 font-bold uppercase mb-2">Active Debts</h4>
                <div id="active-loans-container" class="space-y-2">
                    <!-- Populated by JS -->
                    <div class="text-zinc-600 text-xs italic">No active loans.</div>
                </div>
            </div>

            <!-- New Loans -->
            <h4 class="text-xs text-zinc-500 font-bold uppercase mb-2">Available Credits</h4>
            <div class="grid grid-cols-1 gap-3">
                <div class="bg-zinc-800 p-3 rounded border border-zinc-700 flex justify-between items-center">
                    <div>
                        <div class="text-white font-bold text-sm">Payday Loan</div>
                        <div class="text-[10px] text-zinc-400">Get $500 ‚Ä¢ Pay $750 (3 Days)</div>
                    </div>
                    <button onclick="takeLoan('payday')" class="bg-green-700 hover:bg-green-600 text-white text-xs px-3 py-1.5 rounded font-bold">Take $500</button>
                </div>
                <div class="bg-zinc-800 p-3 rounded border border-zinc-700 flex justify-between items-center">
                    <div>
                        <div class="text-white font-bold text-sm">Biz Credit</div>
                        <div class="text-[10px] text-zinc-400">Get $2,000 ‚Ä¢ Pay $2,500 (10 Days)</div>
                    </div>
                    <button onclick="takeLoan('biz')" class="bg-green-700 hover:bg-green-600 text-white text-xs px-3 py-1.5 rounded font-bold">Take $2k</button>
                </div>
                <div class="bg-zinc-800 p-3 rounded border border-red-900/50 flex justify-between items-center">
                    <div>
                        <div class="text-red-400 font-bold text-sm">Shark Loan</div>
                        <div class="text-[10px] text-zinc-400">Get $5,000 ‚Ä¢ Pay $10,000 (30 Days)</div>
                    </div>
                    <button onclick="takeLoan('shark')" class="bg-red-900 hover:bg-red-800 text-white text-xs px-3 py-1.5 rounded font-bold">Risk $5k</button>
                </div>
            </div>
        </div>
    </div>

    <!-- REGISTRATION SCREEN -->
    <div id="registration-screen" class="fixed inset-0 bg-zinc-950 z-[100] flex flex-col items-center justify-center p-4 overflow-y-auto">
        <div class="bg-zinc-900 p-8 rounded-xl shadow-2xl max-w-lg w-full border border-zinc-800 my-auto relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-pink-500 to-violet-600"></div>
            <h1 class="text-2xl font-bold text-center mb-1 text-white tracking-tight">CREATOR ID SETUP</h1>
            <p class="text-center text-zinc-500 text-xs mb-8 uppercase tracking-widest">Platform Registration</p>
            
            <div class="space-y-5">
                <div>
                    <label class="block text-xs font-semibold text-zinc-400 mb-1 uppercase">Handle</label>
                    <div class="flex items-center">
                        <span class="bg-zinc-800 p-3 rounded-l border-y border-l border-zinc-700 text-zinc-400">@</span>
                        <input type="text" id="reg-handle" class="w-full bg-zinc-900 border border-zinc-700 rounded-r p-3 text-white focus:outline-none focus:border-pink-500 transition-colors" placeholder="creator_name">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-semibold text-zinc-400 mb-2 uppercase">Age Group</label>
                        <div class="flex flex-col gap-2" id="age-selection">
                            <button onclick="selectAge('18-19')" id="age-18-19" class="age-btn w-full bg-zinc-800 border border-zinc-700 rounded p-2 text-xs text-zinc-400 hover:bg-zinc-700 transition flex justify-between items-center">
                                <span>18-19</span> <span class="text-[10px] text-green-500 bg-green-500/10 px-1 rounded">High Bonus</span>
                            </button>
                            <button onclick="selectAge('20-24')" id="age-20-24" class="age-btn w-full bg-zinc-800 border border-zinc-700 rounded p-2 text-xs text-zinc-400 hover:bg-zinc-700 transition flex justify-between items-center">
                                <span>20-24</span> <span class="text-[10px] text-yellow-500 bg-yellow-500/10 px-1 rounded">Med Bonus</span>
                            </button>
                            <button onclick="selectAge('25+')" id="age-25+" class="age-btn w-full bg-zinc-800 border border-zinc-700 rounded p-2 text-xs text-zinc-400 hover:bg-zinc-700 transition flex justify-between items-center">
                                <span>25+</span> <span class="text-[10px] text-red-400 bg-red-500/10 px-1 rounded">Low Bonus</span>
                            </button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-zinc-400 mb-2 uppercase">City Base</label>
                        <input type="text" id="reg-location" class="w-full bg-zinc-900 border border-zinc-700 rounded p-3 text-white focus:border-pink-500 text-sm transition-colors" placeholder="e.g. Miami, NYC">
                        <p class="text-[10px] text-zinc-500 mt-2">Influences trending topics.</p>
                    </div>
                </div>
                <!-- Photo Upload ID -->
                <div>
                    <label class="block text-xs font-semibold text-zinc-400 mb-2 uppercase">Biometric Verification</label>
                    <div class="flex items-center gap-4 bg-zinc-800/50 p-3 rounded border border-zinc-800">
                        <div id="id-preview-box" class="w-16 h-16 rounded bg-black border border-zinc-700 overflow-hidden relative flex-shrink-0">
                            <div id="scan-overlay" class="hidden absolute inset-0 bg-green-500/20 z-10">
                                <div class="scan-line"></div>
                            </div>
                            <img id="id-preview-img" src="" class="w-full h-full object-cover hidden">
                            <i id="id-placeholder-icon" data-lucide="scan-face" class="w-6 h-6 text-zinc-600 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"></i>
                        </div>
                        <div class="flex-1">
                            <input type="file" id="reg-photo" accept="image/*" onchange="handleIdUpload()" class="hidden">
                            <button onclick="document.getElementById('reg-photo').click()" class="text-xs bg-zinc-700 hover:bg-zinc-600 text-white py-1.5 px-3 rounded transition mb-1">
                                Upload Photo ID
                            </button>
                            <div id="verification-status" class="text-[10px] text-zinc-500">Required for payouts.</div>
                        </div>
                    </div>
                </div>
                <button onclick="submitRegistration()" id="btn-register" class="w-full bg-white text-black hover:bg-zinc-200 font-bold py-3.5 rounded mt-4 uppercase tracking-widest transition-all opacity-50 cursor-not-allowed" disabled>
                    Initialize Account
                </button>
            </div>
        </div>
    </div>

    <!-- TIER INFO MODAL -->
    <div id="tier-modal" class="hidden fixed inset-0 bg-black/80 z-[70] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-zinc-900 border border-zinc-700 p-6 rounded-xl max-w-md w-full">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-white">Career Ladder</h3>
                <button onclick="closeTierModal()" class="text-zinc-500 hover:text-white"><i data-lucide="x"></i></button>
            </div>
            
            <div class="space-y-3 text-sm">
                <div class="bg-zinc-800/50 p-3 rounded border border-zinc-700 flex justify-between items-center">
                    <div>
                        <div class="font-bold text-zinc-400">OPPRESSED</div>
                        <div class="text-[10px] text-zinc-500">Starting Rank</div>
                    </div>
                    <div class="text-right">
                        <div class="text-red-400 font-mono font-bold">50% TAX</div>
                        <div class="text-[10px] text-zinc-500">+$0 Bonus/Like</div>
                    </div>
                </div>
                <div class="flex justify-center"><i data-lucide="arrow-down" class="text-zinc-600 w-4 h-4"></i></div>
                <div class="bg-zinc-800/50 p-3 rounded border-l-2 border-purple-500 flex justify-between items-center">
                    <div>
                        <div class="font-bold text-purple-400">FIGHTER</div>
                        <div class="text-[10px] text-zinc-500">Req: 500 Subs</div>
                    </div>
                    <div class="text-right">
                        <div class="text-orange-400 font-mono font-bold">40% TAX</div>
                        <div class="text-[10px] text-zinc-500">+$3 Bonus/Like</div>
                    </div>
                </div>
                <div class="flex justify-center"><i data-lucide="arrow-down" class="text-zinc-600 w-4 h-4"></i></div>
                <div class="bg-zinc-800/50 p-3 rounded border-l-2 border-pink-500 flex justify-between items-center shadow-[0_0_15px_rgba(236,72,153,0.1)]">
                    <div>
                        <div class="font-bold text-pink-500">QUEEN</div>
                        <div class="text-[10px] text-zinc-500">Req: 5,000 Subs + Studio</div>
                    </div>
                    <div class="text-right">
                        <div class="text-green-400 font-mono font-bold">25% TAX</div>
                        <div class="text-[10px] text-zinc-500">+$5 Bonus/Like</div>
                    </div>
                </div>
            </div>
            <p class="text-center text-[10px] text-zinc-500 mt-6">Tax is deducted daily from gross earnings.</p>
        </div>
    </div>

    <!-- SHOP MODAL -->
    <div id="shop-modal" class="hidden fixed inset-0 bg-black/90 z-[70] flex items-center justify-center p-4">
        <div class="bg-zinc-900 border border-zinc-700 rounded-xl max-w-lg w-full h-[600px] flex flex-col overflow-hidden">
            <div class="p-4 border-b border-zinc-800 flex justify-between items-center bg-zinc-900 z-10">
                <h3 class="text-lg font-bold text-white flex items-center gap-2">
                    <i data-lucide="shopping-bag" class="text-pink-500"></i> Marketplace
                </h3>
                <div class="flex gap-4 items-center">
                    <span class="font-mono text-green-400 font-bold" id="shop-balance">$0</span>
                    <button onclick="closeShopModal()" class="text-zinc-500 hover:text-white"><i data-lucide="x"></i></button>
                </div>
            </div>
            
            <!-- Tabs -->
            <div class="flex text-xs font-bold uppercase tracking-wider border-b border-zinc-800 bg-zinc-900">
                <button onclick="switchShopTab('consumable')" id="tab-consumable" class="shop-tab active flex-1 py-3 text-center transition hover:bg-zinc-800">Consumables</button>
                <button onclick="switchShopTab('hardware')" id="tab-hardware" class="shop-tab flex-1 py-3 text-center transition hover:bg-zinc-800">Hardware</button>
                <button onclick="switchShopTab('clout')" id="tab-clout" class="shop-tab flex-1 py-3 text-center transition hover:bg-zinc-800">Clout</button>
            </div>

            <!-- Shop Content -->
            <div id="shop-content" class="flex-1 overflow-y-auto p-4 space-y-2 bg-zinc-950/50">
                <!-- Injected via JS -->
            </div>
        </div>
    </div>

    <!-- AGENCY MODAL -->
    <div id="agency-modal" class="hidden fixed inset-0 bg-black/90 z-[70] flex items-center justify-center p-4">
        <div class="bg-zinc-900 border border-purple-600 p-6 rounded-xl max-w-2xl w-full relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-purple-600"></div>
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h3 class="text-xl font-bold text-white uppercase italic tracking-widest">Talent Mgmt</h3>
                    <p class="text-zinc-400 text-xs">Agencies take a cut but provide perks. <span class="text-red-400">They are ruthless.</span></p>
                </div>
                <button onclick="closeAgencyModal()" class="text-zinc-500 hover:text-white"><i data-lucide="x"></i></button>
            </div>
            
            <div id="agency-selection-ui" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <!-- Generated JS -->
            </div>
            <button onclick="signAgency()" id="btn-sign-agency" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 rounded text-xs uppercase disabled:opacity-50 disabled:cursor-not-allowed" disabled>Sign Contract</button>
            
            <!-- Active Contract View -->
            <div id="agency-active-ui" class="hidden text-center py-4">
                <div class="bg-zinc-800/50 p-6 rounded-xl border border-zinc-700">
                    <div class="text-purple-400 font-bold text-2xl mb-1" id="current-agency-name">...</div>
                    <div class="text-zinc-500 text-xs uppercase tracking-widest mb-6">Exclusive Contract</div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-zinc-900 p-3 rounded">
                            <div class="text-xs text-zinc-500 mb-1">Satisfaction</div>
                            <div class="w-full h-2 bg-zinc-800 rounded-full overflow-hidden">
                                <div id="agency-satisfaction-bar" class="h-full bg-green-500 transition-all duration-500" style="width: 100%"></div>
                            </div>
                            <div id="agency-satisfaction-text" class="text-[10px] text-right mt-1 text-zinc-400">100/100</div>
                        </div>
                        <div class="bg-zinc-900 p-3 rounded flex flex-col justify-center">
                            <div class="text-xs text-zinc-500">Revenue Split</div>
                            <div class="font-mono text-white" id="agency-split-display">...</div>
                        </div>
                    </div>

                    <div class="text-left bg-black/20 p-3 rounded mb-6">
                        <div class="text-[10px] text-zinc-500 uppercase font-bold mb-1">Current Demand:</div>
                        <div id="agency-demand-text" class="text-sm text-zinc-200 italic">"..."</div>
                    </div>

                    <button onclick="breakContract()" class="bg-red-900/20 hover:bg-red-900/40 border border-red-900 text-red-400 px-6 py-3 rounded font-bold uppercase text-xs w-full transition">
                        Breach Contract (Penalty: -30% Subs)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MINI GAME MODAL -->
    <div id="minigame-modal" class="hidden fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4">
        <div class="bg-zinc-900 border-2 border-yellow-600 p-6 rounded-xl max-w-sm w-full text-center relative overflow-hidden">
            <h2 class="text-2xl font-black text-yellow-500 mb-2 uppercase italic">High Stakes Bet</h2>
            <p class="text-zinc-300 text-sm mb-4">"I bet $100 you can't guess the next card!"</p>
            
            <div class="bg-black/40 p-3 rounded mb-4 text-xs text-left border border-zinc-800">
                <div class="flex justify-between mb-2">
                    <span class="text-green-400 font-bold">WIN:</span>
                    <span>Get <span class="text-green-400">$100</span> Cash</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-red-500 font-bold">LOSE:</span>
                    <span class="text-right">Post <span id="penalty-req" class="text-pink-400 font-bold">Feet Pic</span><br><span class="text-[10px] text-zinc-500">(Earns $0.00)</span></span>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="closeMiniGame()" class="flex-1 bg-zinc-800 hover:bg-zinc-700 py-3 rounded text-xs text-zinc-400">Decline</button>
                <button onclick="startCardGame()" class="flex-1 bg-yellow-600 hover:bg-yellow-500 text-black font-bold py-3 rounded text-xs uppercase">Accept Challenge</button>
            </div>
        </div>
    </div>

    <!-- ACTIVE CARD GAME MODAL -->
    <div id="card-game-modal" class="hidden fixed inset-0 bg-black/90 z-[70] flex items-center justify-center p-4">
        <div class="bg-zinc-900 p-8 rounded-xl w-full max-w-xs text-center border border-zinc-700">
            <h3 class="text-zinc-500 text-xs uppercase mb-6 tracking-widest">High / Low</h3>
            
            <div class="flex justify-center items-center gap-4 mb-8">
                <div class="w-24 h-36 bg-white rounded flex items-center justify-center text-5xl font-black text-black" id="card-display">7</div>
                <div class="w-24 h-36 bg-zinc-800 rounded flex items-center justify-center border-2 border-zinc-600 text-zinc-500 text-2xl font-bold" id="card-mystery">?</div>
            </div>
            <div class="flex gap-2">
                <button onclick="guessCard('lower')" class="flex-1 bg-red-900/50 hover:bg-red-900 border border-red-800 text-red-200 py-3 rounded font-bold">LOWER ‚ñº</button>
                <button onclick="guessCard('higher')" class="flex-1 bg-green-900/50 hover:bg-green-900 border border-green-800 text-green-200 py-3 rounded font-bold">HIGHER ‚ñ≤</button>
            </div>
        </div>
    </div>

    <!-- POST CREATION MODAL -->
    <div id="post-modal" class="hidden fixed inset-0 bg-black/80 z-40 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-zinc-900 p-6 rounded-xl max-w-md w-full border border-zinc-700 shadow-2xl overflow-y-auto max-h-[90vh]">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-white" id="post-modal-title">New Content</h3>
                <button onclick="closePostModal()" class="text-zinc-500 hover:text-white"><i data-lucide="x"></i></button>
            </div>
            
            <!-- TREND ALERT UI -->
            <div class="bg-pink-900/20 border border-pink-500/50 p-3 rounded mb-4 flex justify-between items-center">
                <div>
                    <span class="text-pink-200 text-xs font-bold uppercase tracking-wider block">üî• Daily Trend</span>
                    <span class="text-white font-mono font-bold text-lg" id="post-trend-display">...</span>
                </div>
                <div class="text-right">
                    <span class="text-green-400 font-bold text-xs block">2x View Bonus</span>
                    <span class="text-[10px] text-zinc-500">Include in caption</span>
                </div>
            </div>

            <!-- PENALTY MODE UI -->
            <div id="penalty-ui" class="hidden mb-6 bg-red-950/40 border border-red-900/50 p-4 rounded text-center">
                <p class="text-red-500 text-xs font-bold uppercase mb-2 tracking-widest">DEBT COLLECTION</p>
                <p class="text-white text-lg font-bold mt-1 mb-2"><span id="penalty-target">...</span></p>
                <p class="text-[10px] text-zinc-500 uppercase">This post will earn $0.00</p>
            </div>

            <!-- NORMAL MODE UI -->
            <div id="normal-ui" class="space-y-4">
                <div>
                    <label class="text-xs font-bold text-zinc-500 uppercase mb-2 block">Vibe Check</label>
                    <div class="grid grid-cols-3 gap-2">
                        <div onclick="selectVibe('modest')" id="vibe-modest" class="vibe-option selected cursor-pointer p-3 rounded border border-zinc-700 bg-zinc-800/50 text-center hover:bg-zinc-800 transition">
                            <span class="text-xl block mb-1">üôÇ</span>
                            <span class="text-xs font-bold block text-zinc-300">Modest</span>
                            <div class="text-[9px] text-green-400 mt-1">+5 Rep</div>
                            <div class="text-[9px] text-zinc-500">Low Pay</div>
                        </div>
                        <div onclick="selectVibe('tease')" id="vibe-tease" class="vibe-option cursor-pointer p-3 rounded border border-zinc-700 bg-zinc-800/50 text-center hover:bg-zinc-800 transition">
                            <span class="text-xl block mb-1">üòè</span>
                            <span class="text-xs font-bold block text-zinc-300">Tease</span>
                            <div class="text-[9px] text-red-400 mt-1">-5 Rep</div>
                            <div class="text-[9px] text-zinc-500">Med Pay</div>
                        </div>
                        <div onclick="selectVibe('wild')" id="vibe-wild" class="vibe-option cursor-pointer p-3 rounded border border-zinc-700 bg-zinc-800/50 text-center hover:bg-zinc-800 transition">
                            <span class="text-xl block mb-1">üî•</span>
                            <span class="text-xs font-bold text-zinc-300 block text-pink-500">WILD</span>
                            <div class="text-[9px] text-red-600 mt-1">-15 Rep</div>
                            <div class="text-[9px] text-zinc-500">High Pay</div>
                        </div>
                    </div>
                </div>
                
                <!-- NEW: Exclusivity Check -->
                <div class="flex items-center gap-2 p-3 bg-zinc-800/50 rounded border border-zinc-800">
                    <input type="checkbox" id="post-collab" class="w-4 h-4 rounded bg-zinc-900 border-zinc-700 text-pink-600 focus:ring-0">
                    <div class="flex-1">
                        <label for="post-collab" class="text-sm font-bold text-zinc-300">Collab / With Others</label>
                        <p class="text-[10px] text-zinc-500">May anger jealous partners.</p>
                    </div>
                </div>
            </div>

            <!-- COMMON UI -->
            <div class="space-y-4 mt-6">
                <div>
                    <label class="text-xs font-bold text-zinc-500 uppercase mb-2 block">Media Gallery (Max 3)</label>
                    <div id="media-list" class="flex gap-2 mb-2 overflow-x-auto pb-2">
                        <!-- Media Thumbnails Go Here -->
                    </div>
                    
                    <div class="flex gap-2 mb-2">
                        <input type="file" id="post-file" class="hidden" accept="image/*,video/*" onchange="previewFile()">
                        <button onclick="document.getElementById('post-file').click()" class="flex-1 bg-zinc-800 hover:bg-zinc-700 text-zinc-300 text-xs py-2 px-4 rounded transition border border-zinc-700">
                            <i data-lucide="upload" class="w-4 h-4 inline mr-1"></i> Add File
                        </button>
                        <input type="text" id="post-url" class="flex-1 bg-zinc-950 border border-zinc-800 rounded px-3 text-xs text-white focus:outline-none focus:border-zinc-600" placeholder="Paste URL">
                        <button onclick="addUrl()" class="bg-zinc-800 hover:bg-zinc-700 px-3 rounded border border-zinc-700"><i data-lucide="plus" class="w-4 h-4 text-white"></i></button>
                    </div>
                    <div id="media-preview-area" class="w-full h-48 bg-black border border-zinc-800 rounded flex items-center justify-center overflow-hidden relative">
                        <span class="text-zinc-600 text-xs">No media selected</span>
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-zinc-500 uppercase mb-2 block">Caption</label>
                    <textarea id="post-caption" class="w-full bg-zinc-950 p-3 rounded border border-zinc-800 h-20 text-sm focus:outline-none focus:border-zinc-600 text-white resize-none" placeholder="Write something engaging..."></textarea>
                </div>
                
                <button onclick="submitPost()" id="btn-submit-post" class="w-full bg-white text-black hover:bg-zinc-200 font-bold py-3 rounded mt-2 transition-colors">
                    Publish
                </button>
            </div>
        </div>
    </div>

    <!-- MAIN GAME CONTAINER -->
    <div id="game-container" class="hidden max-w-6xl w-full grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Header -->
        <div class="col-span-1 lg:col-span-3 bg-zinc-900 p-5 rounded-xl border border-zinc-800 flex flex-wrap justify-between items-center shadow-lg">
            <div class="flex items-center gap-4">
                <div class="relative">
                    <img id="player-avatar-display" src="" class="w-14 h-14 rounded-full object-cover border-2 border-zinc-700 bg-black">
                    <div class="absolute -bottom-1 -right-1 bg-green-500 w-4 h-4 rounded-full border-2 border-zinc-900"></div>
                </div>
                <div>
                    <div id="player-handle-display" class="font-bold text-xl text-white">@user</div>
                    <div class="text-xs text-zinc-500 flex items-center gap-1 mt-0.5">
                        <i data-lucide="map-pin" class="w-3 h-3"></i> <span id="location-display">Unknown</span>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-8 mt-4 sm:mt-0 flex-1 justify-end">
                <!-- Rep/Sanity Bars -->
                <div class="hidden md:flex flex-col gap-2 w-48 mr-4">
                    <div class="flex items-center gap-2">
                        <i data-lucide="award" class="w-3 h-3 text-blue-400"></i>
                        <div class="w-full h-1.5 bg-zinc-800 rounded-full group relative">
                            <div id="rep-bar" class="bg-blue-500 h-full rounded-full transition-all" style="width: 70%"></div>
                            <div class="absolute -top-4 left-0 text-[9px] text-zinc-500 hidden group-hover:block">Reputation</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <i data-lucide="brain" class="w-3 h-3 text-pink-400"></i>
                        <div class="w-full h-1.5 bg-zinc-800 rounded-full group relative">
                            <div id="sanity-bar" class="bg-pink-500 h-full rounded-full transition-all" style="width: 100%"></div>
                            <div class="absolute -top-4 left-0 text-[9px] text-zinc-500 hidden group-hover:block">Sanity</div>
                        </div>
                    </div>
                    <!-- Energy Bar -->
                    <div class="flex items-center gap-2">
                        <i data-lucide="zap" class="w-3 h-3 text-yellow-400"></i>
                        <div class="w-full h-1.5 bg-zinc-800 rounded-full group relative">
                            <div id="energy-bar" class="bg-yellow-500 h-full rounded-full transition-all" style="width: 100%"></div>
                            <div class="absolute -top-4 left-0 text-[9px] text-zinc-500 hidden group-hover:block">Energy</div>
                        </div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="flex items-center justify-end gap-1 mb-1">
                        <div class="text-[10px] text-zinc-500 uppercase font-bold tracking-wider">Net Worth</div>
                        <div class="group relative">
                            <i data-lucide="info" class="w-3 h-3 text-zinc-600 cursor-pointer"></i>
                            <div class="absolute right-0 top-6 w-48 bg-black border border-zinc-700 p-2 rounded shadow-xl hidden group-hover:block z-50 text-left">
                                <div class="text-[10px] text-zinc-400 mb-1">Lifetime Stats</div>
                                <div class="text-xs text-white">Gross: <span class="text-green-400" id="stat-gross">$0</span></div>
                                <div class="text-xs text-white">Platform Tax: <span class="text-red-400" id="stat-tax">$0</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="text-2xl font-bold font-mono tracking-tight" id="money-display-wrapper">
                        <span id="money-display" class="text-red-500">-$200.00</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- LEFT COLUMN: Phone -->
        <div class="col-span-1 lg:col-span-1 flex justify-center">
            <div class="w-full max-w-sm bg-black rounded-[3rem] p-3 border-4 border-zinc-800 shadow-2xl relative overflow-hidden h-[700px] flex flex-col">
                <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-24 h-6 bg-black rounded-b-xl z-20"></div>
                
                <div class="bg-zinc-950 flex-1 rounded-[2.2rem] overflow-hidden flex flex-col relative phone-screen">
                    <!-- App Header -->
                    <div class="h-16 flex items-center justify-between px-5 border-b border-zinc-800 bg-zinc-950/80 backdrop-blur z-10 pt-4">
                        <span class="font-bold tracking-tight text-white italic">FanClub</span>
                        <div class="flex gap-2">
                            <div id="fatigue-status" class="hidden w-8 h-8 rounded-full bg-red-900/50 flex items-center justify-center border border-red-500 animate-pulse" title="Fatigue Active">
                                <i data-lucide="eye-off" class="w-4 h-4 text-red-400"></i>
                            </div>
                            <button onclick="toggleArchive()" class="w-8 h-8 rounded-full bg-zinc-800 flex items-center justify-center text-zinc-400 hover:text-white">
                                <i data-lucide="user" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>

                    <!-- EMPTY STATE -->
                    <div id="feed-empty" class="flex-1 flex flex-col items-center justify-center p-6 text-center">
                        <div class="relative mb-6">
                            <img id="phone-avatar-big" src="" class="w-24 h-24 rounded-full object-cover border-4 border-zinc-900 shadow-xl">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2 w-full mb-6">
                            <div class="bg-zinc-900/50 p-3 rounded border border-zinc-800/50">
                                <span class="block text-[10px] text-zinc-500 uppercase tracking-wider">Balance</span>
                                <span class="font-mono text-sm font-bold text-white" id="phone-balance">-$200</span>
                            </div>
                            <div class="bg-zinc-900/50 p-3 rounded border border-zinc-800/50">
                                <span class="block text-[10px] text-zinc-500 uppercase tracking-wider">Rate</span>
                                <span class="font-mono text-sm font-bold text-zinc-300" id="phone-rate">$0/like</span>
                            </div>
                        </div>

                        <button onclick="openPostModal()" id="btn-create-post" class="w-full bg-white text-black hover:bg-zinc-200 font-bold py-3.5 rounded-xl shadow-lg flex items-center justify-center gap-2 mb-3 transition-all">
                            <i data-lucide="plus-circle" class="w-5 h-5"></i> Create Post
                        </button>
                        
                        <p id="post-limit-msg" class="text-xs text-red-500 mt-2 hidden font-medium">Need sleep or Energy Drink.</p>
                    </div>

                    <!-- ACTIVE POST STATE -->
                    <div id="feed-active" class="hidden flex-col h-full overflow-y-auto pb-20 scroll-smooth no-scrollbar">
                        <div id="feed-media-container" class="bg-black w-full flex items-center justify-center relative group overflow-hidden border-b border-zinc-900 carousel-track h-[450px]">
                            <!-- CAROUSEL ITEMS INJECTED HERE -->
                        </div>
                        <div class="flex items-center justify-between p-4 border-b border-zinc-900">
                            <div class="flex flex-col">
                                <div class="flex gap-2 items-center">
                                    <i data-lucide="heart" class="w-5 h-5 text-red-500 fill-red-500 animate-pop"></i>
                                    <span class="text-white font-bold text-lg" id="live-likes">0</span>
                                </div>
                                <div class="text-xs text-zinc-500 font-mono mt-0.5">Earned: $<span id="live-earnings" class="text-green-400">0.00</span></div>
                            </div>
                            <div id="virality-badge" class="text-[10px] font-bold px-2 py-1 rounded bg-zinc-900 text-zinc-500 uppercase border border-zinc-800">
                                Modest
                            </div>
                        </div>
                        <div class="px-4 pb-2 pt-3">
                            <div class="text-sm text-zinc-300">
                                <span class="font-bold text-white mr-1" id="post-handle">@user</span>
                                <span id="post-caption-display" class="text-zinc-400">...</span>
                            </div>
                        </div>
                        <div class="px-4 pt-4 border-t border-zinc-900 mt-2">
                            <h4 class="text-[10px] font-bold text-zinc-600 uppercase mb-3 tracking-widest">Comments</h4>
                            <div id="comments-container" class="space-y-3 text-sm pb-4"></div>
                        </div>
                    </div>

                    <!-- ARCHIVE -->
                    <div id="feed-archive" class="hidden flex-col h-full overflow-y-auto p-4 space-y-4 pb-20">
                        <h2 class="text-xs font-bold text-zinc-600 uppercase text-center mb-2 tracking-widest">Archive</h2>
                        <div id="archive-container" class="space-y-4"></div>
                    </div>
                    
                    <button id="btn-reply" onclick="replyToComments()" class="hidden absolute bottom-6 right-6 bg-blue-600 hover:bg-blue-500 text-white p-4 rounded-full shadow-lg z-20 animate-bounce">
                        <i data-lucide="message-square" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN: Stats & Controls -->
        <div class="col-span-1 lg:col-span-2 flex flex-col gap-6">
            
            <!-- Rank Progress -->
            <div class="glass-panel p-6 rounded-xl flex flex-col md:flex-row justify-between items-start gap-4">
                <div>
                    <div class="flex items-center gap-2 mb-1">
                        <span class="text-zinc-500 text-xs uppercase font-bold tracking-wider">Current Tier</span>
                        <button onclick="openTierModal()" class="text-[10px] bg-zinc-800 hover:bg-zinc-700 text-zinc-300 px-2 py-0.5 rounded border border-zinc-700 transition">View Benefits</button>
                    </div>
                    <div class="text-4xl font-black text-zinc-600 tracking-tight" id="tier-name">OPPRESSED</div>
                    <div class="text-sm text-zinc-400 mt-1 flex items-center gap-2">
                        Tax Rate: <span id="current-tax-rate" class="text-red-400 font-mono">50%</span>
                    </div>
                </div>
                <div class="text-right">
                    <div class="flex items-center gap-2 justify-end text-white">
                        <i data-lucide="users" class="w-5 h-5 text-zinc-500"></i>
                        <span class="text-3xl font-bold" id="subs-display">0</span>
                    </div>
                    <div class="text-xs text-zinc-500 uppercase tracking-wider font-bold">Subscribers</div>
                    <div class="text-xs text-zinc-600 mt-1" id="rate-info-rank">Rank Bonus: +$0</div>
                </div>
            </div>

            <!-- Dashboard -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 h-full">
                <!-- Expenses -->
                <div class="glass-panel p-6 rounded-xl">
                    <h2 class="text-lg font-bold flex items-center gap-2 text-white mb-6 border-b border-zinc-800 pb-2">
                        <i data-lucide="receipt" class="text-zinc-500 w-5 h-5"></i> Daily Burn
                    </h2>
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between items-center text-zinc-400">
                            <span>Apartment Rent</span>
                            <span id="cost-rent" class="text-white font-mono">-$75.00</span>
                        </div>
                        <div id="dynamic-expenses-container">
                             <!-- Dynamic daily costs go here -->
                        </div>
                        <div id="loan-payment-container" class="hidden flex justify-between items-center bg-green-950/20 p-2 rounded border border-green-900/30">
                            <span class="text-green-400 text-xs font-bold uppercase">Loan Payments</span>
                            <span id="cost-loan" class="text-green-400 font-mono">-$0.00</span>
                        </div>
                        <div id="tax-container" class="hidden flex justify-between items-center bg-red-950/20 p-2 rounded border border-red-900/30">
                            <span class="text-red-400 text-xs font-bold uppercase">Platform Tax</span>
                            <span id="cost-tax" class="text-red-400 font-mono">-$0.00</span>
                        </div>
                        <div class="flex justify-between pt-4 border-t border-zinc-800 mt-2">
                            <span class="font-bold text-zinc-500 text-xs uppercase tracking-wider pt-1">Total Deductions</span>
                            <span id="total-daily-cost" class="font-bold text-red-500 text-lg">-$115.00</span>
                        </div>
                    </div>
                </div>

                <!-- Controls -->
                <div class="glass-panel p-6 rounded-xl flex flex-col justify-between">
                    <div>
                        <h2 class="text-lg font-bold flex items-center gap-2 text-white mb-6 border-b border-zinc-800 pb-2">
                            <i data-lucide="gamepad-2" class="text-zinc-500 w-5 h-5"></i> Activities
                        </h2>
                        
                        <div class="grid grid-cols-3 gap-2 mb-3">
                            <button onclick="openShopModal()" class="bg-zinc-800 hover:bg-zinc-700 p-2 rounded text-sm flex flex-col items-center justify-center gap-1 border border-zinc-700">
                                <i data-lucide="shopping-bag" class="text-pink-500 w-4 h-4"></i>
                                <span class="text-zinc-300 text-[10px] font-bold">Shop</span>
                            </button>
                            <button onclick="openAgencyModal()" id="btn-agency" class="bg-zinc-800 hover:bg-zinc-700 p-2 rounded text-sm flex flex-col items-center justify-center gap-1 border border-zinc-700">
                                <i data-lucide="briefcase" class="text-purple-500 w-4 h-4"></i>
                                <span class="text-zinc-300 text-[10px] font-bold">Agency</span>
                            </button>
                            <button onclick="openBankModal()" class="bg-zinc-800 hover:bg-zinc-700 p-2 rounded text-sm flex flex-col items-center justify-center gap-1 border border-zinc-700">
                                <i data-lucide="landmark" class="text-green-500 w-4 h-4"></i>
                                <span class="text-zinc-300 text-[10px] font-bold">Bank</span>
                            </button>
                        </div>
                        
                        <!-- Mini Game Trigger -->
                        <button onclick="triggerMiniGame()" id="btn-minigame" class="w-full bg-zinc-900 hover:bg-zinc-800 p-4 rounded text-sm flex items-center justify-between group border border-yellow-900/30 hover:border-yellow-700/50 transition-all mb-2">
                            <div class="text-left">
                                <span class="block font-bold text-yellow-500">Fan Challenge</span>
                                <span class="text-xs text-zinc-500 group-hover:text-zinc-400">Risk/Reward Mini-Game</span>
                            </div>
                            <i data-lucide="chevron-right" class="text-zinc-600 group-hover:text-white"></i>
                        </button>
                        
                        <!-- Referral Trigger -->
                        <button onclick="buyReferral()" class="w-full bg-zinc-900 hover:bg-zinc-800 p-4 rounded text-sm flex items-center justify-between group border border-blue-900/30 hover:border-blue-700/50 transition-all mb-2">
                            <div class="text-left">
                                <span class="block font-bold text-blue-500">Recruit Friend</span>
                                <span class="text-xs text-zinc-500 group-hover:text-zinc-400">Cost: $100 (50% Fail Rate)</span>
                            </div>
                            <i data-lucide="user-plus" class="text-zinc-600 group-hover:text-white"></i>
                        </button>

                        <!-- Parasocial Action Button (Hidden by default) -->
                        <div id="parasocial-action-container" class="hidden">
                            <button onclick="chatParasocial()" class="w-full bg-pink-900/30 hover:bg-pink-900/50 p-4 rounded text-sm flex items-center justify-between group border border-pink-700/50 transition-all">
                                <div class="text-left">
                                    <span class="block font-bold text-pink-400">Chat with Partner</span>
                                    <span class="text-xs text-zinc-500 group-hover:text-zinc-300">Cost: 30 Energy (Required)</span>
                                </div>
                                <i data-lucide="message-circle-heart" class="text-pink-500"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mt-4 flex gap-2">
                        <button onclick="takeDayOff()" class="flex-1 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 font-bold py-3 rounded-lg shadow-lg flex justify-center items-center gap-1 transition text-xs border border-zinc-700">
                            <i data-lucide="coffee" class="w-3 h-3"></i> Day Off
                        </button>
                        <button onclick="endDay()" class="flex-[2] bg-zinc-100 hover:bg-white text-black font-bold py-3 rounded-lg shadow-lg flex justify-center items-center gap-2 transition transform active:scale-95 text-xs">
                            <i data-lucide="moon" class="w-3 h-3"></i> End Day & Bills
                        </button>
                    </div>
                    <p class="text-[10px] text-center text-zinc-600 mt-2">Day Off resets Fatigue & Streak.</p>
                </div>
            </div>
            
            <!-- Log -->
            <div class="bg-black/40 rounded-xl p-4 h-32 overflow-y-auto log-scroll border border-zinc-800 text-xs font-mono text-zinc-400" id="game-log">
                <div class="text-green-500">> System initialized. Debt: -$200.</div>
            </div>
        </div>
    </div>

    <!-- GAME OVER -->
    <div id="game-over-modal" class="hidden fixed inset-0 bg-black flex items-center justify-center z-[80]">
        <div class="text-center p-10 border border-red-900 bg-zinc-950 rounded-2xl max-w-lg w-full">
            <h2 class="text-6xl font-black text-red-600 mb-2 tracking-tighter" id="game-over-title">BANKRUPT</h2>
            <p class="text-zinc-400 text-lg mb-8 uppercase tracking-widest" id="game-over-msg">Career Terminated</p>
            
            <div class="bg-red-950/20 p-4 rounded border border-red-900/50 mb-8 text-left">
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-zinc-500">Final Rank:</span>
                    <span id="final-rank" class="text-white font-bold">...</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-zinc-500">Subscribers:</span>
                    <span id="final-subs" class="text-white font-bold">...</span>
                </div>
            </div>
            <button onclick="location.reload()" class="w-full bg-white text-black font-bold py-4 rounded hover:bg-zinc-200 uppercase tracking-widest transition">Restart Simulation</button>
        </div>
    </div>

    <script>
        // --- DATA ---
        const RANKS = [
            { name: "OPPRESSED", threshold: 0, color: "text-zinc-600", desc: "Starting Out", bonus: 0, tax: 0.50 },
            { name: "FIGHTER", threshold: 500, color: "text-purple-400", desc: "Rising Star", bonus: 3, tax: 0.40 },
            { name: "QUEEN", threshold: 5000, color: "text-pink-500", desc: "Platform Elite", bonus: 5, tax: 0.25 }
        ];

        const AGE_DATA = {
            "18-19": { postBonus: 10, likeBonus: 2 },
            "20-24": { postBonus: 5, likeBonus: 1 },
            "25+": { postBonus: 2, likeBonus: 0.5 }
        };

        const EXPENSE_FLAVOR = [
            "UberEats Binge", "Forgot Subscription", "Makeup Refill", "Broken Nail", "Data Overage", "Impulse Buy", "Vet Bill", "Parking Ticket"
        ];

        const DAILY_TRENDS = [
            "Sabrina Tears", "Bedroom Eyes", "Post Shower", "Yoga Pants",
            "Lip Bite", "Silhouette", "Messy Hair", "Night Gown",
            "Gym Sweat", "Cherry Red", "Wet Look", "Mirror Selfie"
        ];

        const LOAN_TYPES = {
            'payday': { name: "Payday Loan", amount: 500, total: 750, days: 3 },
            'biz': { name: "Business Loan", amount: 2000, total: 2500, days: 10 },
            'shark': { name: "Shark Loan", amount: 5000, total: 10000, days: 30 }
        };

        const SHOP_ITEMS = [
            // Consumables
            { id: 'coffee', name: 'Iced Latte', type: 'consumable', price: 20, desc: '+15 Energy', effect: (s) => { s.energy = Math.min(100, s.energy + 15); log("Caffeine hit. +15 Energy.", "text-yellow-400"); } },
            { id: 'spa', name: 'Spa Day', type: 'consumable', price: 100, desc: '+40 Sanity', effect: (s) => { s.sanity = Math.min(100, s.sanity + 40); log("Relaxed. +40 Sanity.", "text-pink-400"); } },
            { id: 'energy_drink', name: 'Glitch Energy', type: 'consumable', price: 45, desc: '+40 Energy', effect: (s) => { s.energy = Math.min(100, s.energy + 40); log("Power up. +40 Energy.", "text-yellow-400"); } },
            { id: 'pr_stunt', name: 'PR Stunt', type: 'consumable', price: 250, desc: '+25 Reputation', effect: (s) => { s.reputation = Math.min(100, s.reputation + 25); log("Publicity stunt worked. +25 Rep.", "text-blue-400"); } },
            
            // Hardware
            { id: 'ringlight', name: 'Ring Light', type: 'hardware', price: 200, desc: '+5% Tip Chance', durability: true, effect: (s) => { s.upgrades.ringlight = true; s.equipmentHealth.ringlight = 100; } },
            { id: 'mirrorless', name: '4K Mirrorless', type: 'hardware', price: 1500, desc: '+15% Sub Growth', durability: true, effect: (s) => { s.upgrades.camera = true; s.equipmentHealth.camera = 100; } },
            { id: 'studio', name: 'Pro Studio', type: 'hardware', price: 5000, desc: 'Unlocks QUEEN Rank', durability: true, effect: (s) => { s.upgrades.studio = true; s.equipmentHealth.studio = 100; } },
            { id: 'apartment', name: 'Luxury Apt', type: 'hardware', price: 2500, desc: 'Passive Sanity Heal', effect: (s) => { s.upgrades.apartment = true; } },

            // Clout
            { id: 'bot_farm', name: 'Bot Farm', type: 'clout', price: 300, desc: '+200 Subs (RISK!)', effect: (s) => { 
                s.subscribers += 200; 
                s.reputation -= 15; 
                log("Bots added. Rep dropped -15.", "text-red-400"); 
            }},
            { id: 'verify', name: 'Blue Check', type: 'clout', price: 1000, desc: '+Max Rep', effect: (s) => { 
                s.reputation = 100;
                s.upgrades.verified = true;
                log("Verified status acquired.", "text-blue-500");
            }},
            { id: 'security', name: 'Cyber Security', type: 'clout', price: 500, desc: 'Prevents Leaks', effect: (s) => { s.upgrades.security = true; } },
        ];

        const AGENCIES = {
            "chatter": { 
                name: "Chatter Farm", 
                tax: 0.40, 
                currentTax: 0.40,
                retainer: 0, 
                color: "text-blue-400",
                desc: "We manage DMs. Reply often.",
                requirement: "Must Reply to 1 Comment/Day",
                check: (state) => state.repliedToday,
                failMsg: "You ignored the fans.",
                perk: "Slows Sanity drain by 20%."
            },
            "viral": { 
                name: "Viral House", 
                tax: 0.50,
                currentTax: 0.50, 
                retainer: 0, 
                color: "text-pink-500", 
                desc: "Go big. WILD posts only.",
                requirement: "Must post WILD content.",
                check: (state) => state.lastVibe === 'wild',
                failMsg: "Content too boring.",
                perk: "Double subscriber growth."
            },
            "boutique": { 
                name: "Boutique Mgmt", 
                tax: 0.20,
                currentTax: 0.20,
                retainer: 50, 
                color: "text-yellow-400", 
                desc: "Premium. Keep Rep high.",
                requirement: "Reputation > 70",
                check: (state) => state.reputation > 70,
                failMsg: "Reputation too low.",
                perk: "Prevents major scandals."
            }
        };

        const BASE_LIKE_RATE = 2.0;
        const PENALTY_TASKS = ["Feet Pic", "Cosplay", "Abs", "No Makeup", "Messy Hair"];
        const COMMENTS_WILD = ["OMG YES", "Take my money", "Finally", "Queen energy", "Obsessed"];
        const COMMENTS_SAFE = ["Cute fit", "Nice lighting", "Pretty", "Okay I guess", "Smile more", "Glow up"];
        const COMMENTS_BAD = ["Boring", "Unsubbed", "Show more", "Waste of time"];

        // --- STATE ---
        let player = { handle: "", photo: null, ageRange: "20-24", location: "Los Angeles" };
        
        let state = {
            day: 1,
            money: -200.00,
            energy: 100,
            reputation: 70,
            sanity: 100,
            subscribers: 0,
            postedToday: false,
            repliedToday: false,
            rankIdx: 0,
            costs: { rent: 75, lastTax: 0 },
            dynamicExpenses: [], 
            activePost: null,
            pastPosts: [],
            tempMedia: [], 
            currentEarnings: 0,
            selectedVibe: 'modest',
            lastVibe: null,
            penaltyActive: false,
            penaltyTask: "",
            dailyTrend: "",
            
            // Hardcore Mechanics
            burnoutDaysLeft: 0,
            leakPenaltyActive: 0, 
            referralCount: 0,
            referralIncome: 0,
            
            // Stats
            lifetimeEarnings: 0,
            platformRevenue: 0,

            // Bank
            loans: [], // { name, totalOwed, dailyPay, daysLeft }

            // Fatigue System
            streak: 0,
            fatigue: 0, // "Dead Eyes" level

            // Relationships
            parasocial: { active: false, maintained: false },
            blackmail: { active: false, multiplier: 1 },

            // Agency State
            agency: null,
            agencySatisfaction: 100, 
            
            upgrades: { camera: false, security: false, studio: false, ringlight: false, apartment: false, verified: false },
            equipmentHealth: { camera: 100, ringlight: 100, studio: 100 }
        };

        let liveInterval = null;
        let cardGame = { current: 0 };
        let selectedAgencyTemp = null;
        let activeShopTab = 'consumable';

        // --- HELPER ---
        function setText(id, text) {
            const el = document.getElementById(id);
            if(el) el.innerText = text;
        }

        function log(msg, cls="text-zinc-400") {
            const div = document.createElement('div');
            div.className = `mb-1 ${cls}`;
            div.innerText = `> ${msg}`;
            const logEl = document.getElementById('game-log');
            if(logEl) logEl.prepend(div);
        }

        // --- REGISTRATION ---
        function selectAge(range) {
            player.ageRange = range;
            document.querySelectorAll('.age-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById(`age-${range}`).classList.add('selected');
        }

        function handleIdUpload() {
            const file = document.getElementById('reg-photo').files[0];
            if(!file) return;
            const url = URL.createObjectURL(file);
            player.photo = url;
            
            document.getElementById('id-placeholder-icon').classList.add('hidden');
            const img = document.getElementById('id-preview-img');
            img.src = url;
            img.classList.remove('hidden');
            
            setText('verification-status', "Verifying identity...");
            document.getElementById('scan-overlay').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('scan-overlay').classList.add('hidden');
                setText('verification-status', "Verified");
                document.getElementById('verification-status').className = "text-green-500 font-bold";
                document.getElementById('btn-register').disabled = false;
                document.getElementById('btn-register').classList.remove('opacity-50', 'cursor-not-allowed');
            }, 1500);
        }

        function submitRegistration() {
            const h = document.getElementById('reg-handle').value;
            const loc = document.getElementById('reg-location').value;
            if(!h || !loc) return alert("Fill all fields.");
            
            player.handle = "@" + h.replace('@','');
            player.location = loc;
            if(!document.querySelector('.age-btn.selected')) selectAge('20-24');
            setText('player-handle-display', player.handle);
            document.getElementById('player-avatar-display').src = player.photo;
            document.getElementById('phone-avatar-big').src = player.photo;
            setText('location-display', player.location);
            
            document.getElementById('registration-screen').classList.add('hidden');
            document.getElementById('game-container').classList.remove('hidden');
            
            initGame();
        }

        function initGame() {
            lucide.createIcons();
            updateTrend(); // Set initial trend
            updateUI();
            log(`Account active. Starter Debt: -$200.00`, "text-red-500");
        }

        function updateTrend() {
            state.dailyTrend = DAILY_TRENDS[Math.floor(Math.random() * DAILY_TRENDS.length)];
            log(`üî• TREND ALERT: Post with "${state.dailyTrend}" in caption!`, "text-pink-500 font-bold");
            updateUI();
        }

        // --- MODALS ---
        function openTierModal() { document.getElementById('tier-modal').classList.remove('hidden'); }
        function closeTierModal() { document.getElementById('tier-modal').classList.add('hidden'); }
        
        // --- SHOP SYSTEM ---
        function openShopModal() { 
            if(state.burnoutDaysLeft > 0) return alert("You are burned out. You can only sleep.");
            document.getElementById('shop-modal').classList.remove('hidden'); 
            renderShop();
        }
        function closeShopModal() { document.getElementById('shop-modal').classList.add('hidden'); }

        function switchShopTab(tab) {
            activeShopTab = tab;
            document.querySelectorAll('.shop-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            renderShop();
        }

        function renderShop() {
            setText('shop-balance', `$${state.money.toFixed(0)}`);
            const container = document.getElementById('shop-content');
            container.innerHTML = "";

            const items = SHOP_ITEMS.filter(i => i.type === activeShopTab);

            items.forEach(item => {
                const owned = state.upgrades[item.id] === true;
                const canAfford = state.money >= item.price;
                
                let btnClass = "bg-zinc-700 text-white hover:bg-green-600";
                let btnText = `$${item.price}`;
                let disabled = false;
                let isBroken = false;
                
                // Durability Logic
                if (owned && item.durability) {
                    const health = state.equipmentHealth[item.id];
                    if (health <= 0) {
                        isBroken = true;
                        btnClass = "bg-red-900 text-red-200 border border-red-500 hover:bg-red-800";
                        btnText = `Repair ($${item.price / 2})`;
                        disabled = false; // Enable for repair
                    } else {
                        btnClass = "bg-green-900/50 text-green-400 border border-green-800 cursor-default";
                        btnText = `${health}% Health`;
                        disabled = true;
                    }
                } else if (owned) {
                    btnClass = "bg-green-900/50 text-green-400 border border-green-800 cursor-default";
                    btnText = "Owned";
                    disabled = true;
                } else if (!canAfford) {
                    btnClass = "bg-zinc-800 text-zinc-500 cursor-not-allowed";
                    disabled = true;
                }

                const div = document.createElement('div');
                div.className = "flex justify-between items-center bg-zinc-900 p-3 rounded border border-zinc-800";
                div.innerHTML = `
                    <div>
                        <div class="font-bold text-white text-sm">${item.name}</div>
                        <div class="text-[10px] text-zinc-400">${item.desc}</div>
                    </div>
                    <button onclick="${isBroken ? `repairItem('${item.id}', ${item.price})` : `buyShopItem('${item.id}')`}" class="${btnClass} text-xs px-3 py-1.5 rounded font-bold transition" ${disabled ? 'disabled' : ''}>
                        ${btnText}
                    </button>
                `;
                container.appendChild(div);
            });
        }

        function repairItem(id, originalPrice) {
            const cost = originalPrice / 2;
            if(state.money < cost) return alert("Can't afford repairs.");
            state.money -= cost;
            state.equipmentHealth[id] = 100;
            log(`Repaired ${id}. -$${cost}`, "text-yellow-400");
            renderShop();
            updateUI();
        }

        function buyShopItem(id) {
            const item = SHOP_ITEMS.find(i => i.id === id);
            if (!item) return;
            if (state.money < item.price) return;

            state.money -= item.price;
            item.effect(state);
            renderShop();
            updateUI();
        }

        // --- BANK SYSTEM ---
        function openBankModal() {
            if(state.burnoutDaysLeft > 0) return alert("You are burned out.");
            document.getElementById('bank-modal').classList.remove('hidden');
            renderBank();
        }
        function closeBankModal() { document.getElementById('bank-modal').classList.add('hidden'); }

        function renderBank() {
            const container = document.getElementById('active-loans-container');
            container.innerHTML = "";
            
            if (state.loans.length === 0) {
                container.innerHTML = '<div class="text-zinc-600 text-xs italic">No active loans.</div>';
                return;
            }

            state.loans.forEach((loan, idx) => {
                const div = document.createElement('div');
                div.className = "bg-zinc-800 p-3 rounded border border-zinc-700 flex justify-between items-center";
                div.innerHTML = `
                    <div>
                        <div class="text-white font-bold text-sm">${loan.name}</div>
                        <div class="text-[10px] text-zinc-400">Owe: $${loan.totalOwed.toFixed(2)} ‚Ä¢ ${loan.daysLeft} days left</div>
                    </div>
                    <button onclick="payLoanEarly(${idx})" class="bg-zinc-700 hover:bg-green-700 text-white text-xs px-2 py-1 rounded">Pay All</button>
                `;
                container.appendChild(div);
            });
        }

        function takeLoan(type) {
            const loanData = LOAN_TYPES[type];
            state.money += loanData.amount;
            state.loans.push({
                name: loanData.name,
                totalOwed: loanData.total,
                dailyPay: loanData.total / loanData.days,
                daysLeft: loanData.days
            });
            log(`Loan taken: +$${loanData.amount}. Debt increased.`, "text-green-400");
            renderBank();
            updateUI();
        }

        function payLoanEarly(idx) {
            const loan = state.loans[idx];
            if (state.money < loan.totalOwed) return alert("Not enough cash to pay off loan.");
            
            state.money -= loan.totalOwed;
            log(`Paid off ${loan.name}! -$${loan.totalOwed.toFixed(2)}`, "text-yellow-400");
            state.loans.splice(idx, 1);
            renderBank();
            updateUI();
        }

        // --- AGENCY SYSTEM ---
        function openAgencyModal() {
            if(state.burnoutDaysLeft > 0) return alert("You are burned out. You can only sleep.");
            document.getElementById('agency-modal').classList.remove('hidden');
            
            if(state.agency) {
                document.getElementById('agency-selection-ui').classList.add('hidden');
                document.getElementById('btn-sign-agency').classList.add('hidden');
                document.getElementById('agency-active-ui').classList.remove('hidden');
                
                const ag = AGENCIES[state.agency];
                setText('current-agency-name', ag.name);
                setText('agency-split-display', `${(ag.currentTax * 100).toFixed(1)}% Tax`);
                setText('agency-demand-text', ag.requirement);
                
                // Update Satisfaction Bar
                const bar = document.getElementById('agency-satisfaction-bar');
                bar.style.width = `${state.agencySatisfaction}%`;
                setText('agency-satisfaction-text', `${state.agencySatisfaction}/100`);
                
                // Color logic
                if(state.agencySatisfaction > 70) bar.className = "h-full bg-green-500 transition-all duration-500";
                else if(state.agencySatisfaction > 30) bar.className = "h-full bg-yellow-500 transition-all duration-500";
                else bar.className = "h-full bg-red-500 transition-all duration-500";

            } else {
                renderAgencySelection();
                document.getElementById('agency-selection-ui').classList.remove('hidden');
                document.getElementById('btn-sign-agency').classList.remove('hidden');
                document.getElementById('agency-active-ui').classList.add('hidden');
            }
        }
        function closeAgencyModal() { document.getElementById('agency-modal').classList.add('hidden'); }

        function renderAgencySelection() {
            const container = document.getElementById('agency-selection-ui');
            container.innerHTML = "";
            
            Object.keys(AGENCIES).forEach(key => {
                const ag = AGENCIES[key];
                const div = document.createElement('div');
                div.id = `agency-${key}`;
                div.className = "agency-card cursor-pointer bg-zinc-800 p-4 rounded border border-zinc-700 hover:bg-zinc-700 transition";
                div.onclick = () => selectAgencyOption(key);
                
                div.innerHTML = `
                    <div class="font-bold ${ag.color} mb-1">${ag.name}</div>
                    <div class="text-xs text-zinc-300 mb-2 h-8">"${ag.desc}"</div>
                    <ul class="text-[10px] text-zinc-400 space-y-1 mb-3">
                        <li class="text-red-400">-${(ag.tax*100)}% Tax</li>
                        ${ag.retainer > 0 ? `<li class="text-red-400">$${ag.retainer}/Day Fee</li>` : ''}
                        <li class="text-zinc-500 italic">Req: ${ag.requirement}</li>
                    </ul>
                `;
                container.appendChild(div);
            });
        }

        function selectAgencyOption(type) {
            selectedAgencyTemp = type;
            document.querySelectorAll('.agency-card').forEach(c => c.classList.remove('selected'));
            document.getElementById(`agency-${type}`).classList.add('selected');
            document.getElementById('btn-sign-agency').disabled = false;
            document.getElementById('btn-sign-agency').classList.remove('opacity-50', 'cursor-not-allowed');
        }

        function signAgency() {
            if(!selectedAgencyTemp) return;
            state.agency = selectedAgencyTemp;
            state.agencySatisfaction = 80; // Start at 80
            closeAgencyModal();
            log(`Signed with ${AGENCIES[state.agency].name}.`, "text-purple-400");
            updateUI();
        }

        function breakContract() {
            if(state.money < 500) return alert("Need $500 for legal fees!");
            state.money -= 500;
            const lostSubs = Math.floor(state.subscribers * 0.30);
            state.subscribers -= lostSubs;
            
            log(`Contract Broken. -$500. Lost ${lostSubs} subs (Agency Ownership Clause).`, "text-red-500 font-bold");
            state.agency = null;
            // Reset taxes
            AGENCIES['viral'].currentTax = AGENCIES['viral'].tax;
            
            selectedAgencyTemp = null;
            closeAgencyModal();
            updateUI();
        }

        // --- MINI GAME ---
        function triggerMiniGame() {
            if(state.burnoutDaysLeft > 0) return alert("You are burned out.");
            if(state.money < -1000) return alert("You are too bankrupt to bet.");
            const task = PENALTY_TASKS[Math.floor(Math.random() * PENALTY_TASKS.length)];
            setText('penalty-req', task);
            document.getElementById('minigame-modal').classList.remove('hidden');
        }
        function closeMiniGame() { document.getElementById('minigame-modal').classList.add('hidden'); }
        function startCardGame() {
            closeMiniGame();
            document.getElementById('card-game-modal').classList.remove('hidden');
            cardGame.current = Math.floor(Math.random() * 13) + 1;
            setText('card-display', cardGame.current);
            setText('card-mystery', "?");
        }
        function guessCard(guess) {
            const next = Math.floor(Math.random() * 13) + 1;
            setText('card-mystery', next);
            
            let win = false;
            if(guess === 'higher' && next >= cardGame.current) win = true;
            if(guess === 'lower' && next <= cardGame.current) win = true;
            
            setTimeout(() => {
                document.getElementById('card-game-modal').classList.add('hidden');
                if(win) {
                    state.money += 100;
                    log("Mini-game WIN! +$100.00", "text-green-400 font-bold");
                } else {
                    state.penaltyActive = true;
                    state.penaltyTask = document.getElementById('penalty-req').innerText;
                    log(`Mini-game LOST. Penalty debt: ${state.penaltyTask}`, "text-red-500 font-bold");
                }
                updateUI();
            }, 1000);
        }

        // --- REFERRAL ---
        function buyReferral() {
            if(state.burnoutDaysLeft > 0) return alert("You are burned out.");
            if(state.money < 100) return alert("Need $100 to bribe a friend.");
            state.money -= 100;
            
            if(Math.random() > 0.5) {
                state.referralCount++;
                log("Friend recruited! They might earn you money.", "text-green-400");
            } else {
                log("Friend took the $100 and ghosted you.", "text-red-400");
            }
            updateUI();
        }

        // --- PARASOCIAL & BLACKMAIL ---
        function triggerBlackmail() {
            const cost = 500 * state.blackmail.multiplier;
            setText('blackmail-cost', `-$${cost}`);
            document.getElementById('blackmail-modal').classList.remove('hidden');
        }

        function handleBlackmail(choice) {
            document.getElementById('blackmail-modal').classList.add('hidden');
            if (choice === 'pay') {
                const cost = 500 * state.blackmail.multiplier;
                if (state.money < cost) {
                    log("Couldn't afford hush money. Link leaked.", "text-red-600 font-bold");
                    state.reputation = 10;
                    state.sanity = 10;
                } else {
                    state.money -= cost;
                    log(`Paid hush money ($${cost}). Safe for now...`, "text-yellow-400");
                    // 50% chance they come back
                    if (Math.random() > 0.5) {
                        state.blackmail.multiplier *= 2;
                        log("Threat Level Increased.", "text-red-400");
                    }
                }
            } else {
                log("Ignored threat. Doxxed. Stats crashed to 10.", "text-red-600 font-bold");
                state.reputation = 10;
                state.sanity = 10;
            }
            updateUI();
        }

        function triggerParasocialOffer() {
            document.getElementById('parasocial-modal').classList.remove('hidden');
        }

        function acceptParasocial() {
            document.getElementById('parasocial-modal').classList.add('hidden');
            state.parasocial.active = true;
            state.parasocial.maintained = false;
            log("Accepted Exclusive Partner. Don't post other people.", "text-pink-500 font-bold");
            updateUI();
        }

        function chatParasocial() {
            if (state.energy < 30) return log("Too tired to chat.", "text-red-400");
            state.energy -= 30;
            state.parasocial.maintained = true;
            log("Chatted with partner. Relationship maintained.", "text-pink-400");
            updateUI();
        }

        // --- POSTING ---
        function selectVibe(vibe) {
            if(state.penaltyActive) return;
            state.selectedVibe = vibe;
            document.querySelectorAll('.vibe-option').forEach(e => e.classList.remove('selected'));
            document.getElementById(`vibe-${vibe}`).classList.add('selected');
        }
        function previewFile() {
            const file = document.getElementById('post-file').files[0];
            if(file) {
                const url = URL.createObjectURL(file);
                // Detect type
                const type = file.type.startsWith('video/') ? 'video' : 'image';
                addMediaToState(url, type);
            }
        }
        function addUrl() {
            const url = document.getElementById('post-url').value;
            if(url) {
                // Determine type by extension roughly, default to image
                const isVideo = url.match(/\.(mp4|webm|ogg)$/i);
                addMediaToState(url, isVideo ? 'video' : 'image');
                document.getElementById('post-url').value = "";
            }
        }
        function addMediaToState(url, type) {
            if(state.tempMedia.length >= 3) return alert("Max 3 items per post.");
            state.tempMedia.push({url, type});
            renderMediaList();
        }
        function renderMediaList() {
            const list = document.getElementById('media-list');
            if(!list) return;
            
            list.innerHTML = "";
            state.tempMedia.forEach((item) => {
                let el;
                if (item.type === 'video') {
                    el = document.createElement('video');
                    el.src = item.url;
                    el.className = "w-10 h-10 object-cover rounded border border-zinc-700 flex-shrink-0 bg-black";
                } else {
                    el = document.createElement('img');
                    el.src = item.url;
                    el.className = "w-10 h-10 object-cover rounded border border-zinc-700 flex-shrink-0";
                }
                list.appendChild(el);
            });
            
            const preview = document.getElementById('media-preview-area');
            if(!preview) return;
            if(state.tempMedia.length > 0) {
                const first = state.tempMedia[0];
                if(first.type === 'video') {
                    preview.innerHTML = `<video src="${first.url}" class="w-full h-full object-cover" autoplay loop muted></video>`;
                } else {
                    preview.innerHTML = `<img src="${first.url}" class="w-full h-full object-cover">`;
                }
            } else {
                preview.innerHTML = '<span class="text-zinc-600 text-xs">No media selected</span>';
            }
        }
        function openPostModal() {
            if(state.burnoutDaysLeft > 0) return alert("You are burned out. You can only sleep.");
            if(state.energy < 15) return log("Energy depleted. Sleep required.", "text-red-400");
            document.getElementById('post-modal').classList.remove('hidden');
            state.tempMedia = [];
            renderMediaList();
            
            if(state.penaltyActive) {
                document.getElementById('penalty-ui').classList.remove('hidden');
                document.getElementById('normal-ui').classList.add('hidden');
                setText('penalty-target', state.penaltyTask);
                setText('post-modal-title', "Settle Penalty");
                setText('btn-submit-post', "Upload Penalty Content");
                const sBtn = document.getElementById('btn-submit-post');
                sBtn.classList.add('bg-red-600', 'text-white', 'hover:bg-red-500');
                sBtn.classList.remove('bg-white', 'text-black');
            } else {
                document.getElementById('penalty-ui').classList.add('hidden');
                document.getElementById('normal-ui').classList.remove('hidden');
                setText('post-modal-title', "New Content");
                setText('btn-submit-post', "Publish");
                const sBtn = document.getElementById('btn-submit-post');
                sBtn.classList.remove('bg-red-600', 'text-white', 'hover:bg-red-500');
                sBtn.classList.add('bg-white', 'text-black');
                selectVibe(state.selectedVibe);
            }
        }
        function closePostModal() { document.getElementById('post-modal').classList.add('hidden'); }
        
        function submitPost() {
            const caption = document.getElementById('post-caption').value;
            const isCollab = document.getElementById('post-collab').checked;

            if(state.tempMedia.length === 0) return alert("At least one media item required.");
            
            // PARASOCIAL CHECK
            if (state.parasocial.active && isCollab) {
                state.parasocial.active = false;
                state.reputation = Math.max(0, state.reputation - 40);
                log("üíî PARTNER DUMPED YOU! Collab detected. Leaked private photos. -40 Rep.", "text-red-600 font-bold");
                closePostModal();
                updateUI();
                return; // Stop post? Or allow it with damage? Let's stop it to force player to realize mistake.
            }

            let cost = 15;
            let potentialLikes = 20;
            let vibe = state.selectedVibe;
            let isPenalty = false;
            let repChange = 0;
            let sanityChange = -5;

            if(state.penaltyActive) {
                isPenalty = true;
                cost = 20;
                potentialLikes = 150;
                vibe = "Penalty";
                state.penaltyActive = false;
                repChange = -10;
                sanityChange = -15;
                log("Penalty fulfilled. Account unlocked.", "text-zinc-400");
            } else {
                if(vibe === 'modest') {
                    cost = 15; potentialLikes = 15;
                    repChange = 5; sanityChange = -2;
                }
                if(vibe === 'tease') {
                    cost = 30; potentialLikes = 80;
                    repChange = -2; sanityChange = -8;
                }
                if(vibe === 'wild') {
                    cost = 60; potentialLikes = 300;
                    repChange = -15; sanityChange = -25;
                }
            }

            if(state.energy < cost) return alert("Not enough energy.");
            state.energy -= cost;
            state.reputation = Math.max(0, Math.min(100, state.reputation + repChange));
            state.sanity = Math.max(0, state.sanity + sanityChange);
            state.postedToday = true;
            closePostModal();

            // DAMAGE EQUIPMENT
            if(state.upgrades.camera) state.equipmentHealth.camera = Math.max(0, state.equipmentHealth.camera - 10);
            if(state.upgrades.ringlight) state.equipmentHealth.ringlight = Math.max(0, state.equipmentHealth.ringlight - 10);
            if(state.upgrades.studio) state.equipmentHealth.studio = Math.max(0, state.equipmentHealth.studio - 5);

            // LEAK CHECK
            if(!isPenalty && vibe !== 'modest' && !state.upgrades.security) {
                // 10% chance to leak
                if(Math.random() < 0.10) {
                    state.leakPenaltyActive = 3;
                    state.reputation = Math.min(100, state.reputation + 20);
                    state.agencySatisfaction -= 30;
                    log("üö® CONTENT LEAKED! +Rep, but 0 Growth for 3 days.", "text-red-500 font-bold");
                }
            }

            // FATIGUE & STREAK
            // Fatigue applies immediately to earnings
            let fatigueMultiplier = 1.0 - (state.fatigue * 0.10); // 10% penalty per level
            if(state.fatigue > 0) log(`Dead Eyes: Earnings -${state.fatigue * 10}%`, "text-red-400");

            let fatigueSpamMult = 1.0;
            if (state.lastVibe === vibe && !isPenalty) {
                fatigueSpamMult = 0.5;
                log(`Viewer Fatigue: Earnings halved from spamming ${vibe.toUpperCase()}. Mix it up!`, "text-orange-400");
            }
            state.lastVibe = vibe;

            // TREND MATCH CHECK
            const trendMatch = caption.toLowerCase().includes(state.dailyTrend.toLowerCase());
            let trendMult = 1.0;
            
            if (trendMatch) {
                trendMult = 2.0; 
                log("üî• Trend Matched! 2x Reach Boost.", "text-pink-400 font-bold");
            }

            const tierMult = 1 + (state.rankIdx * 0.5);
            let agencyBoost = (state.agency === 'viral') ? 2.0 : 1.0;
            
            // Check for broken equipment
            const camBoost = (state.upgrades.camera && state.equipmentHealth.camera > 0) ? 1.15 : 1.0;
            if(state.upgrades.camera && state.equipmentHealth.camera <= 0) log("Camera is broken! No bonus.", "text-red-400");
            
            const finalMaxLikes = Math.floor(potentialLikes * tierMult * fatigueSpamMult * agencyBoost * camBoost * trendMult * fatigueMultiplier * (0.8 + Math.random() * 0.4));
            
            state.currentEarnings = 0;
            state.activePost = {
                media: [...state.tempMedia],
                caption: caption,
                vibe: vibe,
                likes: 0,
                maxLikes: Math.max(1, finalMaxLikes),
                timestamp: `Day ${state.day}`,
                isPenalty: isPenalty
            };

            if(!isPenalty) {
                state.currentEarnings += AGE_DATA[player.ageRange].postBonus;
            }
            
            renderFeedStart();
        }

        function renderFeedStart() {
            document.getElementById('feed-empty').classList.add('hidden');
            document.getElementById('feed-archive').classList.add('hidden');
            document.getElementById('feed-active').classList.remove('hidden');
            document.getElementById('feed-active').classList.add('flex');
            
            const container = document.getElementById('feed-media-container');
            container.innerHTML = "";
            state.activePost.media.forEach(item => {
                const el = document.createElement('div');
                el.className = "carousel-item w-full h-full flex-shrink-0";
                
                if (item.type === 'video') {
                    el.innerHTML = `<video src="${item.url}" class="w-full h-full object-cover" autoplay loop muted playsinline></video>`;
                } else {
                    el.innerHTML = `<img src="${item.url}" class="w-full h-full object-cover">`;
                }
                container.appendChild(el);
            });
            
            setText('post-caption-display', state.activePost.caption || "...");
            setText('virality-badge', state.activePost.vibe.toUpperCase());
            setText('live-earnings', state.currentEarnings.toFixed(2));
            document.getElementById('comments-container').innerHTML = "";
            document.getElementById('btn-reply').classList.remove('hidden');
            
            clearInterval(liveInterval);
            liveInterval = setInterval(simulateLiveFeed, 100);
            log(`Published content.`, "text-zinc-400");
        }

        function simulateLiveFeed() {
            if(!state.activePost) return;
            if(state.activePost.likes >= state.activePost.maxLikes) return;
            state.activePost.likes++;
            setText('live-likes', state.activePost.likes);
            
            if(!state.activePost.isPenalty) {
                const ageData = AGE_DATA[player.ageRange];
                const rankBonus = RANKS[state.rankIdx].bonus;
                let perLike = BASE_LIKE_RATE + rankBonus + ageData.likeBonus;
                
                if(state.upgrades.camera && state.equipmentHealth.camera > 0) perLike += 1;
                
                // Ring light logic
                if(state.upgrades.ringlight && state.equipmentHealth.ringlight > 0 && Math.random() > 0.9) perLike += 5;
                
                state.currentEarnings += perLike;
                state.money += perLike;
                state.lifetimeEarnings += perLike;
            }
            
            setText('live-earnings', state.currentEarnings.toFixed(2));
            if(Math.random() > 0.8) addComment();
        }

        function addComment() {
            let pool = COMMENTS_SAFE;
            if(state.activePost.vibe === 'wild') pool = COMMENTS_WILD;
            else if(state.activePost.vibe === 'modest') pool = Math.random() > 0.5 ? COMMENTS_SAFE : COMMENTS_BAD;
            
            const txt = pool[Math.floor(Math.random() * pool.length)];
            const div = document.createElement('div');
            div.className = "pop-in flex gap-2 mb-2";
            div.innerHTML = `
                <div class="w-5 h-5 rounded-full bg-zinc-700 flex-shrink-0"></div>
                <div><span class="font-bold text-xs block text-zinc-500">fan_${Math.floor(Math.random()*999)}</span><span class="text-zinc-300 text-xs">${txt}</span></div>
            `;
            const c = document.getElementById('comments-container');
            if(c) {
                c.prepend(div);
                if(c.children.length > 5) c.lastChild.remove();
            }
        }

        function replyToComments() {
            if(state.energy < 10) return log("Not enough energy to reply.", "text-red-400");
            state.energy -= 10;
            state.repliedToday = true;

            const roll = Math.random();
            let likeChange = 0;
            let logMsg = "";
            let logColor = "text-zinc-400";

            if (roll < 0.60) {
                likeChange = Math.floor(Math.random() * 21) + 20; 
                logMsg = `Reply went viral! +${likeChange} likes`;
                logColor = "text-green-400 font-bold";
            } else if (roll < 0.90) {
                likeChange = 0;
                logMsg = "Reply ignored.";
                logColor = "text-zinc-500";
            } else {
                likeChange = - (Math.floor(Math.random() * 21) + 10);
                state.reputation = Math.max(0, state.reputation - 3);
                state.sanity = Math.max(0, state.sanity - 5);
                logMsg = `Drama in comments! -3 Rep`;
                logColor = "text-red-500 font-bold";
            }

            state.activePost.maxLikes = Math.max(1, state.activePost.maxLikes + likeChange);

            const div = document.createElement('div');
            div.className = "pop-in flex gap-2 pl-4 border-l-2 border-blue-500 mb-2";
            div.innerHTML = `<div><span class="font-bold text-blue-400 text-xs">You</span><span class="text-white text-xs">Thanks luv! x</span></div>`;
            document.getElementById('comments-container').prepend(div);

            log(logMsg, logColor);
            updateUI();
        }

        // --- SYSTEM ---
        function toggleArchive() {
            if(state.activePost) return alert("End current day first.");
            const archive = document.getElementById('feed-archive');
            const empty = document.getElementById('feed-empty');
            
            if(archive.classList.contains('hidden')) {
                empty.classList.add('hidden');
                archive.classList.remove('hidden');
                archive.classList.add('flex');
                renderArchive();
            } else {
                archive.classList.add('hidden');
                archive.classList.remove('flex');
                empty.classList.remove('hidden');
            }
        }

        function renderArchive() {
            const container = document.getElementById('archive-container');
            container.innerHTML = "";
            if(state.pastPosts.length === 0) container.innerHTML = "<div class='text-center text-zinc-600 text-sm py-10'>No history.</div>";
            
            state.pastPosts.slice().reverse().forEach(post => {
                const el = document.createElement('div');
                el.className = "bg-zinc-900 rounded p-2 flex gap-3 border border-zinc-800";
                
                let thumb;
                if (post.media.length > 0 && post.media[0].type === 'video') {
                    // Create a video thumbnail
                    thumb = `<video src="${post.media[0].url}" class="w-16 h-16 object-cover rounded bg-black" muted></video>`;
                } else {
                    const src = (post.media.length > 0) ? post.media[0].url : "";
                    thumb = `<img src="${src}" class="w-16 h-16 object-cover rounded bg-black">`;
                }

                el.innerHTML = `
                    ${thumb}
                    <div class="flex-1">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-[10px] text-zinc-500">${post.timestamp}</span>
                            <span class="text-[10px] font-bold px-1.5 py-0.5 rounded bg-zinc-800 text-zinc-400">${post.vibe}</span>
                        </div>
                        <div class="text-xs text-white truncate w-32 mb-1">${post.caption}</div>
                        <div class="text-[10px] text-green-500 font-mono">+$${post.earned.toFixed(2)}</div>
                    </div>
                `;
                container.appendChild(el);
            });
        }

        function takeDayOff() {
            if(state.burnoutDaysLeft > 0) return alert("You are burned out already.");
            
            state.energy = 100;
            state.sanity = Math.min(100, state.sanity + 20);
            state.streak = 0; // Reset streak
            state.fatigue = 0; // Reset fatigue
            log("Day Off taken. Sanity restored. Streak reset.", "text-cyan-400");
            
            endDay(true); // true = skip post processing
        }

        function endDay(skippedPost = false) {
            clearInterval(liveInterval);
            document.getElementById('btn-reply').classList.add('hidden');
            
            // BURNOUT CHECK
            if (state.burnoutDaysLeft > 0) {
                state.burnoutDaysLeft--;
                log(`Burnout Recovery: ${state.burnoutDaysLeft} days left.`, "text-red-400");
                if(state.burnoutDaysLeft === 0) {
                    state.sanity = 50; // Reset to half
                    log("You have recovered from burnout.", "text-green-500");
                }
            } else if (state.sanity <= 20) {
                state.burnoutDaysLeft = 2; // Trigger burnout
                log("ü§Ø MENTAL BREAKDOWN! You entered Burnout.", "text-red-600 font-bold");
            }

            // FATIGUE & STREAK LOGIC
            if (!skippedPost) {
                if (state.postedToday) {
                    state.streak++;
                    if(state.streak > 3) {
                        state.fatigue++;
                        log("‚ö†Ô∏è Overworked. Fatigue increased.", "text-red-400");
                    }
                } else {
                    // Didn't post, didn't officially take day off
                    state.streak = 0;
                    state.fatigue = 0; // Natural rest?
                }
            }

            // PARASOCIAL MAINTENANCE
            if (state.parasocial.active) {
                if (state.parasocial.maintained) {
                    state.parasocial.maintained = false;
                    state.money += 200;
                    state.lifetimeEarnings += 200;
                    log("Partner paid bills. +$200", "text-pink-400");
                } else {
                    state.parasocial.active = false;
                    state.reputation = Math.max(0, state.reputation - 20);
                    state.subscribers = Math.floor(state.subscribers * 0.9);
                    log("üíî Partner left (Ignored). Leaked DMs. -20 Rep.", "text-red-600 font-bold");
                }
            } else {
                // Random chance to get offer
                if (state.subscribers > 100 && Math.random() < 0.15) {
                    triggerParasocialOffer();
                }
            }

            // BLACKMAIL CHANCE
            if (Math.random() < 0.05 && state.money > 200) {
                triggerBlackmail();
            }

            let grossToday = 0;
            let subsGained = 0;
            
            if(state.activePost) {
                grossToday = state.currentEarnings;
                state.activePost.earned = grossToday;
                state.pastPosts.push(state.activePost);
                
                // LEAK PENALTY
                if(state.leakPenaltyActive > 0) {
                    subsGained = 0;
                    state.leakPenaltyActive--;
                    log(`Leak Penalty: 0 subs gained. (${state.leakPenaltyActive} days left)`, "text-red-400");
                } else {
                    subsGained = Math.floor(state.activePost.likes / 3);
                }
                
                state.activePost = null;
            }
            
            state.subscribers += subsGained;
            log(`Day End. Gross: $${grossToday.toFixed(2)}`, "text-zinc-300");

            // --- REFERRAL INCOME ---
            let refMoney = 0;
            for(let i=0; i<state.referralCount; i++) {
                if(Math.random() < 0.05) { // 5% chance per friend
                    const amount = [20, 40, 80][Math.floor(Math.random() * 3)];
                    refMoney += amount;
                }
            }
            if(refMoney > 0) {
                state.money += refMoney;
                state.lifetimeEarnings += refMoney;
                log(`Referral Income: +$${refMoney}`, "text-green-400");
            }

            // --- TAX & AGENCY ---
            let taxRate = RANKS[state.rankIdx].tax;
            let agencyRetainer = 0;
            
            if(state.agency) {
                const ag = AGENCIES[state.agency];
                
                // Viral House Escalation
                if(state.agency === 'viral') {
                    ag.currentTax += 0.01;
                    log(`Viral House increased tax to ${(ag.currentTax*100).toFixed(0)}%`, "text-pink-500");
                }
                
                taxRate = ag.currentTax;
                agencyRetainer = ag.retainer;
                
                // Forced Collab
                if(Math.random() < 0.10) { // 10% chance
                    if(state.money >= 200) {
                        state.money -= 200;
                        log("Agency Forced Networking Event: -$200", "text-red-500 font-bold");
                    } else {
                        state.agencySatisfaction -= 30;
                        log("Missed Networking Event (Too Poor). Agency Angry.", "text-red-500");
                    }
                }
                
                // Agency Check
                const passedCheck = ag.check(state);
                if(passedCheck) {
                    state.agencySatisfaction = Math.min(100, state.agencySatisfaction + 5);
                } else {
                    state.agencySatisfaction -= 20;
                    log(`Agency unhappy: ${ag.failMsg} -20 Satisfaction.`, "text-red-500");
                }

                if(state.agencySatisfaction <= 0) {
                    log(`FIRED BY AGENCY! Severance penalty applied.`, "text-red-600 font-bold");
                    state.money -= 250;
                    state.agency = null;
                }
            } else {
                log(`Platform Tax (${(taxRate*100).toFixed(0)}%): -$${(grossToday*taxRate).toFixed(2)}`, "text-red-400");
            }
            
            const taxAmount = grossToday * taxRate;
            state.money -= taxAmount;
            state.costs.lastTax = taxAmount;
            state.platformRevenue += taxAmount;
            if(agencyRetainer > 0) state.money -= agencyRetainer;

            // --- LOAN REPAYMENT ---
            let dailyLoanCost = 0;
            for (let i = state.loans.length - 1; i >= 0; i--) {
                const loan = state.loans[i];
                state.money -= loan.dailyPay;
                loan.totalOwed -= loan.dailyPay;
                loan.daysLeft--;
                dailyLoanCost += loan.dailyPay;
                
                if (loan.daysLeft <= 0) {
                    log(`Loan ${loan.name} fully paid off!`, "text-green-400");
                    state.loans.splice(i, 1);
                }
            }
            if(dailyLoanCost > 0) log(`Loan Payments: -$${dailyLoanCost.toFixed(2)}`, "text-red-400");

            // --- INFLATION & DYNAMIC EXPENSES ---
            const inflationMultiplier = 1.05;
            state.costs.rent *= inflationMultiplier;
            
            // Dynamic Lifestyle Expenses
            state.dynamicExpenses = [];
            const expChance = Math.random();
            if(expChance > 0.3) { // 70% chance of random expense
                const item = EXPENSE_FLAVOR[Math.floor(Math.random() * EXPENSE_FLAVOR.length)];
                const cost = Math.floor(Math.random() * 50) + 20;
                state.dynamicExpenses.push({name: item, cost: cost});
                state.money -= cost;
            }
            
            const dynTotal = state.dynamicExpenses.reduce((acc, curr) => acc + curr.cost, 0);
            const expenses = state.costs.rent + dynTotal;
            state.money -= state.costs.rent; 
            
            log(`Daily Burn: -$${expenses.toFixed(2)}`, "text-orange-500 font-bold");

            // --- PASSIVE EFFECTS ---
            if(state.upgrades.apartment) state.sanity = Math.min(100, state.sanity + 10);
            if(state.agency === 'chatter') state.sanity = Math.min(100, state.sanity + 5);

            // Random Events
            if(!state.upgrades.security && Math.random() > 0.85) {
                log("‚ö†Ô∏è CONTENT LEAK! Sanity dropped.", "text-red-500 font-bold");
                state.sanity -= 30;
                state.subscribers += 200;
            }
            
            // --- UPDATE TREND ---
            updateTrend();

            state.day++;
            state.energy = 100;
            state.postedToday = false;
            state.repliedToday = false;
            
            updateRank();
            
            if(state.money < -1000) triggerGameOver("BANKRUPT", "Debt Exceeded -$1000");
            else if (state.reputation <= 0) triggerGameOver("CANCELLED", "Reputation Hit Zero");
            else {
                document.getElementById('feed-active').classList.add('hidden');
                document.getElementById('feed-archive').classList.add('hidden');
                document.getElementById('feed-empty').classList.remove('hidden');
                document.getElementById('feed-active').classList.remove('flex');
                updateUI();
            }
        }

        function triggerGameOver(title, reason) {
            setText('game-over-title', title);
            setText('game-over-msg', reason);
            setText('final-rank', RANKS[state.rankIdx].name);
            setText('final-subs', state.subscribers.toLocaleString());
            document.getElementById('game-over-modal').classList.remove('hidden');
        }

        function updateRank() {
            let idx = 0;
            RANKS.forEach((r, i) => {
                if(state.subscribers >= r.threshold) {
                    if (r.name === "QUEEN" && !state.upgrades.studio) return;
                    idx = i;
                }
            });
            if(idx > state.rankIdx) {
                state.rankIdx = idx;
                log(`Rank Up: ${RANKS[idx].name}!`, "text-purple-400");
            }
        }

        function updateUI() {
            // BURNOUT UI
            if (state.burnoutDaysLeft > 0) {
                document.getElementById('burnout-screen').classList.remove('hidden');
                setText('burnout-timer', state.burnoutDaysLeft);
            } else {
                document.getElementById('burnout-screen').classList.add('hidden');
            }

            // FATIGUE UI
            if (state.fatigue > 0) {
                document.getElementById('fatigue-status').classList.remove('hidden');
            } else {
                document.getElementById('fatigue-status').classList.add('hidden');
            }

            // PARASOCIAL UI
            if (state.parasocial.active) {
                document.getElementById('parasocial-action-container').classList.remove('hidden');
            } else {
                document.getElementById('parasocial-action-container').classList.add('hidden');
            }

            // TREND UI
            setText('post-trend-display', state.dailyTrend);

            setText('money-display', state.money.toFixed(2));
            document.getElementById('money-display').className = state.money < 0 ? "text-red-500" : "text-green-500";
            
            setText('phone-balance', `$${state.money.toFixed(0)}`);
            document.getElementById('phone-balance').className = state.money < 0 ? "font-mono text-sm font-bold text-red-500" : "font-mono text-sm font-bold text-green-500";
            
            document.getElementById('rep-bar').style.width = `${state.reputation}%`;
            document.getElementById('sanity-bar').style.width = `${state.sanity}%`;
            document.getElementById('energy-bar').style.width = `${state.energy}%`;
            
            setText('subs-display', state.subscribers.toLocaleString());
            
            // STATS HOVER
            setText('stat-gross', `$${state.lifetimeEarnings.toFixed(2)}`);
            setText('stat-tax', `$${state.platformRevenue.toFixed(2)}`);

            const r = RANKS[state.rankIdx];
            setText('tier-name', r.name);
            document.getElementById('tier-name').className = `text-4xl font-black tracking-tight ${r.color}`;
            
            let taxDisplay = r.tax;
            if(state.agency) taxDisplay = AGENCIES[state.agency].currentTax;
            setText('current-tax-rate', `${(taxDisplay * 100).toFixed(0)}%`);
            
            setText('cost-rent', `-$${state.costs.rent.toFixed(2)}`);
            
            // Dynamic Expenses List
            const dynContainer = document.getElementById('dynamic-expenses-container');
            dynContainer.innerHTML = "";
            state.dynamicExpenses.forEach(exp => {
                dynContainer.innerHTML += `
                <div class="flex justify-between items-center text-zinc-400">
                    <span>${exp.name}</span>
                    <span class="text-white font-mono">-$${exp.cost.toFixed(2)}</span>
                </div>`;
            });

            // Loan Payments Display
            let dailyLoan = 0;
            state.loans.forEach(l => dailyLoan += l.dailyPay);
            if(dailyLoan > 0) {
                document.getElementById('loan-payment-container').classList.remove('hidden');
                setText('cost-loan', `-$${dailyLoan.toFixed(2)}`);
            } else {
                document.getElementById('loan-payment-container').classList.add('hidden');
            }

            if(state.costs.lastTax > 0) {
                document.getElementById('tax-container').classList.remove('hidden');
                setText('cost-tax', `-$${state.costs.lastTax.toFixed(2)}`);
            } else {
                document.getElementById('tax-container').classList.add('hidden');
            }

            const btn = document.getElementById('btn-create-post');
            const msg = document.getElementById('post-limit-msg');
            
            if(btn && msg) {
                if(state.postedToday && !state.penaltyActive) {
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                    btn.disabled = true;
                    msg.classList.remove('hidden');
                } else {
                    btn.classList.remove('opacity-50', 'cursor-not-allowed');
                    btn.disabled = false;
                    msg.classList.add('hidden');
                }
            }
            
            const agBtn = document.getElementById('btn-agency');
            if(agBtn) {
                if(state.agency) {
                    agBtn.innerHTML = `<i data-lucide="check-circle" class="text-green-500 w-4 h-4"></i><span class="text-green-400 text-[10px] font-bold">Signed</span>`;
                } else {
                    agBtn.innerHTML = `<i data-lucide="briefcase" class="text-purple-500 w-4 h-4"></i><span class="text-zinc-300 text-[10px] font-bold">Agency</span>`;
                }
            }
            lucide.createIcons();
        }
    </script>
</body>
</html>
